
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>설비 트러블 부동 조치 보고서</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      margin: 0;
    }
    form {
      max-width: 480px;
      margin: 0 auto;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }
    input, select, textarea, button {
      width: 100%;
      font-size: 1rem;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      margin-top: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    pre {
      background-color: #f8f8f8;
      padding: 10px;
      border: 1px solid #ccc;
      white-space: pre-wrap;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
  </style>
  <script>
    let equipmentData = {};
    const unitList = JSON.parse(`["#1-1", "#1-2", "#1-3", "#1-4", "#2-1", "#2-2", "#2-3", "#2-4", "#3-1", "#3-2", "#3-3", "#3-4", "#5-1", "#5-2", "#5-3", "#5-4", "#6-1", "#6-2", "#6-3", "#6-4", "#7-1", "#7-2", "#7-3", "#7-4", "#8-1", "#8-2", "#8-3", "#8-4", "#8-5", "#9-1", "#9-2", "#9-3", "#9-4", "#11-1", "#11-2", "#11-3", "#11-4", "#12-1", "#12-2", "#12-3", "#12-4", "#12-5", "#15-1", "#15-2", "#15-3", "#15-4", "#16-1", "#16-2", "#16-3", "#16-4", "#17-1", "#17-2", "#17-3", "#17-4", "#18-1", "#18-2", "#18-3", "#18-4", "#19-1", "#19-2", "#19-3", "#19-4", "#10-1", "#10-2", "#10-3", "#13-0", "#13-1", "#13-2", "#13-3", "#14-1", "#14-2", "#14-3", "#20-1", "#20-2", "#20-3", "#21-1", "#21-2", "#21-3", "#22-0", "#22-1", "#22-2", "#22-3", "#23-1", "#23-2", "#23-3", "#24-1", "#24-2", "#24-3"]`);

    async function loadEquipmentData() {
      const response = await fetch("equipment_structure_full.json");
      equipmentData = await response.json();
      populateUnitDropdown();
      populateCategoryDropdown(Object.keys(equipmentData.equipment_structure));
    }

    function populateUnitDropdown() {
      const unitSelect = document.getElementById("unit");
      unitList.forEach(unit => {
        const option = document.createElement("option");
        option.value = unit;
        option.textContent = unit;
        unitSelect.appendChild(option);
      });
    }

    function populateCategoryDropdown(categories) {
      const categorySelect = document.getElementById("category");
      categorySelect.innerHTML = '<option disabled selected>대분류 선택</option>';
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });
    }

    function onCategoryChange() {
      const category = document.getElementById("category").value;
      const subSelect = document.getElementById("subcategory");
      subSelect.innerHTML = '<option disabled selected>중분류 선택</option>';
      const subcategories = Object.keys(equipmentData.equipment_structure[category]);
      subcategories.forEach(sub => {
        const option = document.createElement("option");
        option.value = sub;
        option.textContent = sub;
        subSelect.appendChild(option);
      });
      document.getElementById("detail").innerHTML = '<option disabled selected>소분류 선택</option>';
    }

    function onSubcategoryChange() {
      const cat = document.getElementById("category").value;
      const sub = document.getElementById("subcategory").value;
      const items = equipmentData.equipment_structure[cat][sub];
      const detailSelect = document.getElementById("detail");
      detailSelect.innerHTML = '<option disabled selected>소분류 선택</option>';
      items.forEach(i => {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = i;
        detailSelect.appendChild(option);
      });
    }

    function handleAutoNumbering(fieldId, placeholderText) {
      const field = document.getElementById(fieldId);
      field.placeholder = placeholderText;
      field.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          const lines = field.value.split("\n").filter(line => line.trim() !== "");
          if (lines.length === 0 || !lines[lines.length - 1].match(/^\d+\.\s/)) {
            field.value += `${lines.length + 1}. `;
          } else {
            field.value += "\n" + `${lines.length + 1}. `;
          }
        }
      });
    }

    function handleSubmit(event) {
      event.preventDefault();
      const unit = document.getElementById("unit").value;
      const workStart = document.getElementById("workStart").value;
      const workEnd = document.getElementById("workEnd").value;
      const colorStart = document.getElementById("colorStart").value;
      const colorEnd = document.getElementById("colorEnd").value;
      const category = document.getElementById("category").value;
      const subcategory = document.getElementById("subcategory").value;
      const detail = document.getElementById("detail").value;
      const phenomenon = document.getElementById("phenomenon").value;
      const action = document.getElementById("action").value;
      const cause = document.getElementById("cause").value;
      const method = document.getElementById("method").value;
      const group = document.getElementById("categoryGroup").value;

      const result =
`설비 트러블 부동 조치 (${group})
1.호기 : ${unit}
2.작업시간 : ${workStart} ~ ${workEnd}
3.색지도 시간 : ${colorStart} ~ ${colorEnd}
4.설비부위 : ${category} > ${subcategory} > ${detail}
5.현상 : ${phenomenon}
6.조치 내용 :
${action}
7.예상원인 : ${cause}
8.대응 방식 : ${method}`;

      document.getElementById("result").textContent = result;
    }

    window.onload = () => {
      loadEquipmentData();
      handleAutoNumbering("phenomenon", "엔터 입력시 자동 줄바꿈 숫자 구분자 생성");
      handleAutoNumbering("action", "1. 이상 소음 발생 구동부 점검\n2. 구동부 탈거 및 마모 상태 확인\n3. 부품 이상 확인후 교체 진행");
      handleAutoNumbering("cause", "엔터 입력시 자동 줄바꿈 숫자 구분자 생성");
    };
  </script>
</head>
<body>
  <h1>설비 트러블 부동 조치 보고서</h1>
  <form onsubmit="handleSubmit(event)">
    <label>호기:
      <select id="unit" required>
        <option disabled selected>호기 선택</option>
      </select>
    </label>

    <label>작업 시작 시간: <input type="time" id="workStart" required></label>
    <label>작업 종료 시간: <input type="time" id="workEnd" required></label>

    <label>색지도 시작 시간: <input type="time" id="colorStart" required></label>
    <label>색지도 종료 시간: <input type="time" id="colorEnd" required></label>

    <label>설비 대분류:
      <select id="category" onchange="onCategoryChange()" required></select>
    </label>

    <label>설비 중분류:
      <select id="subcategory" onchange="onSubcategoryChange()" required></select>
    </label>

    <label>설비 소분류:
      <select id="detail" required></select>
    </label>

    <label>현상: <textarea id="phenomenon" required></textarea></label>
    <label>조치 내용: <textarea id="action" required></textarea></label>
    <label>예상 원인: <textarea id="cause" required></textarea></label>

    <label>대응 방식:
      <select id="method" required>
        <option value='CS'>CS</option>
        <option value='CS/PDT'>CS/PDT</option>
        <option value='CS/Tech'>CS/Tech</option>
        <option value='CS/Eng'>CS/Eng</option>
      </select>
    </label>

    <label>대응 분류 (괄호 표기):
      <select id="categoryGroup" required>
        <option value='Nine Tech'>Nine Tech</option>
        <option value='Shinjin'>Shinjin</option>
        <option value='OST'>OST</option>
      </select>
    </label>

    <button type="submit">양식 생성</button>
  </form>

  <h3>출력 결과:</h3>
  <pre id="result"></pre>
</body>
</html>
