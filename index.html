
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ESWA 설비 트러블 조치 양식</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    label { display: block; margin-top: 10px; }
    select, input, textarea { width: 300px; padding: 5px; margin-top: 5px; }
  </style>
  <script>
    let equipmentData = {};

    async function loadEquipmentData() {
      try {
        const response = await fetch("equipment_structure_full.json");
        equipmentData = await response.json();
        populateUnitDropdown();
        populateCategoryDropdown(Object.keys(equipmentData.equipment_structure));
      } catch (error) {
        console.error("JSON 파일을 불러오지 못했습니다:", error);
      }
    }

    function populateUnitDropdown() {
      const unitSelect = document.getElementById("unit");
      const allUnits = [...equipmentData.unit_type.NOR, ...equipmentData.unit_type.MEB];
      allUnits.forEach(unit => {
        const option = document.createElement("option");
        option.value = unit;
        option.textContent = unit;
        unitSelect.appendChild(option);
      });
    }

    function populateCategoryDropdown(categories) {
      const categorySelect = document.getElementById("category");
      categorySelect.innerHTML = '<option disabled selected>대분류 선택</option>';
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });
    }

    function onCategoryChange() {
      const category = document.getElementById("category").value;
      const subSelect = document.getElementById("subcategory");
      subSelect.innerHTML = '<option disabled selected>중분류 선택</option>';
      const subcategories = Object.keys(equipmentData.equipment_structure[category]);
      subcategories.forEach(sub => {
        const option = document.createElement("option");
        option.value = sub;
        option.textContent = sub;
        subSelect.appendChild(option);
      });
      document.getElementById("detail").innerHTML = '<option disabled selected>소분류 선택</option>';
    }

    function onSubcategoryChange() {
      const cat = document.getElementById("category").value;
      const sub = document.getElementById("subcategory").value;
      const items = equipmentData.equipment_structure[cat][sub];
      const detailSelect = document.getElementById("detail");
      detailSelect.innerHTML = '<option disabled selected>소분류 선택</option>';
      items.forEach(i => {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = i;
        detailSelect.appendChild(option);
      });
    }

    function handleSubmit(event) {
      event.preventDefault();
      const unit = document.getElementById("unit").value;
      const workStart = document.getElementById("workStart").value;
      const workEnd = document.getElementById("workEnd").value;
      const colorStart = document.getElementById("colorStart").value;
      const colorEnd = document.getElementById("colorEnd").value;
      const category = document.getElementById("category").value;
      const subcategory = document.getElementById("subcategory").value;
      const detail = document.getElementById("detail").value;
      const phenomenon = document.getElementById("phenomenon").value;
      const action = document.getElementById("action").value;
      const cause = document.getElementById("cause").value;
      const method = document.getElementById("method").value;
      const group = document.getElementById("categoryGroup").value;

      const result = 
`설비 트러블 부동 조치 (${group})
1.호기 : ${unit}
2.작업시간 : ${workStart} ~ ${workEnd}
3.색지도 시간 : ${colorStart} ~ ${colorEnd}
4.설비부위 : ${category} > ${subcategory} > ${detail}
5.현상 : ${phenomenon}
6.조치 내용 :
${action}
7.예상원인 : ${cause}
8.대응 방식 : ${method}`;

      document.getElementById("result").textContent = result;
    }

    window.onload = loadEquipmentData;
  </script>
</head>
<body>
  <h2>ESWA 설비 트러블 조치 양식</h2>
  <form onsubmit="handleSubmit(event)">
    <label>호기:
      <select id="unit" required>
        <option disabled selected>호기 선택</option>
      </select>
    </label>

    <label>작업 시작 시간: <input type="time" id="workStart" required></label>
    <label>작업 종료 시간: <input type="time" id="workEnd" required></label>

    <label>색지도 시작 시간: <input type="time" id="colorStart" required></label>
    <label>색지도 종료 시간: <input type="time" id="colorEnd" required></label>

    <label>설비 대분류:
      <select id="category" onchange="onCategoryChange()" required></select>
    </label>

    <label>설비 중분류:
      <select id="subcategory" onchange="onSubcategoryChange()" required></select>
    </label>

    <label>설비 소분류:
      <select id="detail" required></select>
    </label>

    <label>현상: <input id="phenomenon" required></label>
    <label>조치 내용:<br><textarea id="action" rows="4" required></textarea></label>
    <label>예상 원인: <input id="cause" required></label>

    <label>대응 방식:
      <select id="method" required>
        <option value='CS'>CS</option>
        <option value='CS/PDT'>CS/PDT</option>
        <option value='CS/Tech'>CS/Tech</option>
        <option value='CS/Eng'>CS/Eng</option>
      </select>
    </label>

    <label>대응 분류 (괄호 표기):
      <select id="categoryGroup" required>
        <option value='Nine Tech'>Nine Tech</option>
        <option value='Shinjin'>Shinjin</option>
        <option value='OST'>OST</option>
      </select>
    </label>

    <br><br><button type="submit">양식 생성</button>
  </form>

  <h3>출력 결과:</h3>
  <pre id="result"></pre>
</body>
</html>
